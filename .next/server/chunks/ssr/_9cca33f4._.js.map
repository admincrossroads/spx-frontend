{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../lib/api/public-insights.ts","../../../../.next-internal/server/app/%28public%29/insights/reports/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","// Public API functions for fetching published insights (no auth required)\r\n'use server';\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL || '';\r\nconst API_KEY = process.env.NEXT_PUBLIC_API_KEY || '';\r\n\r\nexport interface PublicInsight {\r\n  id: number;\r\n  publicId: string;\r\n  title: string;\r\n  slug: string;\r\n  summary: string;\r\n  type: 'report' | 'publication' | 'policy-brief' | 'blog';\r\n  coverImageUrl: string | null;\r\n  publishedAt: string | null;\r\n  author: {\r\n    id: number;\r\n    name: string;\r\n    imageUrl: string | null;\r\n  };\r\n  tags: Array<{\r\n    id: number;\r\n    name: string;\r\n    slug: string;\r\n  }>;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n}\r\n\r\nexport interface PublicInsightsResponse {\r\n  insights: PublicInsight[];\r\n  pagination: {\r\n    total: number;\r\n    page: number;\r\n    limit: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport interface PublicInsightDetail extends PublicInsight {\r\n  content: Array<{\r\n    id: string;\r\n    type: 'text' | 'image' | 'video' | 'link' | 'quote' | 'table' | 'subTopic';\r\n    data: Record<string, any>;\r\n  }>;\r\n}\r\n\r\n// Fetch published insights (public endpoint, no auth)\r\nexport async function getPublicInsights(filters: {\r\n  type?: string;\r\n  tag?: string;\r\n  search?: string;\r\n  page?: number;\r\n  limit?: number;\r\n} = {}): Promise<PublicInsightsResponse> {\r\n  try {\r\n    const params = new URLSearchParams();\r\n    \r\n    // Always filter for published insights\r\n    params.set('isPublished', 'true');\r\n    \r\n    if (filters.type) params.set('type', filters.type);\r\n    if (filters.tag) params.set('tag', filters.tag);\r\n    if (filters.search) params.set('search', filters.search);\r\n    if (filters.page) params.set('page', filters.page.toString());\r\n    if (filters.limit) params.set('limit', filters.limit.toString());\r\n    \r\n    const query = params.toString();\r\n    const endpoint = `/insights?${query}`;\r\n    const fullUrl = `${API_URL}${endpoint}`;\r\n    \r\n    console.log('Fetching public insights from:', fullUrl);\r\n    \r\n    const headers: HeadersInit = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    \r\n    // Add API key if available (some public endpoints might require it)\r\n    if (API_KEY) {\r\n      headers['x-api-key'] = API_KEY;\r\n    }\r\n    \r\n    const response = await fetch(fullUrl, {\r\n      method: 'GET',\r\n      headers,\r\n      cache: 'no-store',\r\n    });\r\n    \r\n    console.log('Response status:', response.status);\r\n    \r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error('API Error Response:', errorText);\r\n      throw new Error(`Failed to fetch insights: ${response.status} - ${errorText}`);\r\n    }\r\n    \r\n    const data = await response.json();\r\n    console.log('Fetched insights count:', data.insights?.length || 0);\r\n    \r\n    return data;\r\n  } catch (error) {\r\n    console.error('Failed to fetch public insights:', error);\r\n    return { \r\n      insights: [], \r\n      pagination: { total: 0, page: 1, limit: 10, totalPages: 0 } \r\n    };\r\n  }\r\n}\r\n\r\n// Fetch a single published insight by slug (public endpoint, no auth)\r\n// Backend endpoint: GET /api/v1/insights/:slug\r\nexport async function getPublicInsightBySlug(slug: string): Promise<PublicInsightDetail | null> {\r\n  try {\r\n    // Use the slug exactly as provided by the API - don't modify it\r\n    // Backend endpoint format: /api/v1/insights/:slug (not /insights/slug/:slug)\r\n    const endpoint = `/insights/${slug}`;\r\n    const fullUrl = `${API_URL}${endpoint}`;\r\n    \r\n    console.log('Fetching insight by slug from:', fullUrl);\r\n    console.log('Using slug exactly as provided:', slug);\r\n    console.log('API_KEY available:', !!API_KEY);\r\n    \r\n    const headers: HeadersInit = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    \r\n    // Always add API key - backend requires it for ALL requests\r\n    if (!API_KEY) {\r\n      console.error('NEXT_PUBLIC_API_KEY is not set! This is required for the API.');\r\n      throw new Error('API key is not configured');\r\n    }\r\n    \r\n    headers['x-api-key'] = API_KEY;\r\n    \r\n    const response = await fetch(fullUrl, {\r\n      method: 'GET',\r\n      headers,\r\n      cache: 'no-store',\r\n    });\r\n    \r\n    console.log('Response status:', response.status);\r\n    \r\n    if (!response.ok) {\r\n      if (response.status === 404) {\r\n        console.log('Insight not found for slug:', slug);\r\n        return null;\r\n      }\r\n      \r\n      const errorText = await response.text();\r\n      console.error('API Error Response:', errorText);\r\n      console.error('Response status:', response.status);\r\n      \r\n      // Log more details for 401 errors\r\n      if (response.status === 401) {\r\n        console.error('Unauthorized - Check if API key is correct and backend accepts it');\r\n      }\r\n      \r\n      return null;\r\n    }\r\n    \r\n    const data = await response.json();\r\n    console.log('Successfully fetched insight:', data.title || 'Unknown');\r\n    return data;\r\n  } catch (error) {\r\n    console.error(`Failed to fetch insight ${slug}:`, error);\r\n    return null;\r\n  }\r\n}\r\n\r\n","export {getPublicInsights as '404fa085d75cd022597f526cabbc7df8c3393db539'} from 'ACTIONS_MODULE0'\nexport {getPublicInsightBySlug as '40cc71f229b7650b957d6979534e2f0936396e1891'} from 'ACTIONS_MODULE0'\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"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","ignoreList":[0,1]}
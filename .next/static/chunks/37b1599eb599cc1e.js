(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11008,e=>{"use strict";let s=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],11008)},7233,e=>{"use strict";let s=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],7233)},84762,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(47163);let l=t.forwardRef(({className:e,...t},l)=>(0,s.jsx)("textarea",{className:(0,a.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...t}));l.displayName="Textarea",e.s(["Textarea",()=>l])},69074,e=>{"use strict";let s=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>s],69074)},31278,e=>{"use strict";let s=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],31278)},86536,e=>{"use strict";let s=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>s],86536)},64659,e=>{"use strict";let s=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>s],64659)},59411,e=>{"use strict";var s=e.i(71645),t=e.i(48425),a=e.i(43476),l=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),r=s.forwardRef((e,s)=>(0,a.jsx)(t.Primitive.span,{...e,ref:s,style:{...l,...e.style}}));r.displayName="VisuallyHidden",e.s(["VISUALLY_HIDDEN_STYLES",()=>l,"VisuallyHidden",()=>r])},70065,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(47163);let l=t.forwardRef(({className:e,...t},l)=>(0,s.jsx)("div",{ref:l,className:(0,a.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...t}));l.displayName="Card";let r=t.forwardRef(({className:e,...t},l)=>(0,s.jsx)("div",{ref:l,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...t}));r.displayName="CardHeader";let i=t.forwardRef(({className:e,...t},l)=>(0,s.jsx)("div",{ref:l,className:(0,a.cn)("font-semibold leading-none tracking-tight",e),...t}));i.displayName="CardTitle";let n=t.forwardRef(({className:e,...t},l)=>(0,s.jsx)("div",{ref:l,className:(0,a.cn)("text-sm text-muted-foreground",e),...t}));n.displayName="CardDescription";let d=t.forwardRef(({className:e,...t},l)=>(0,s.jsx)("div",{ref:l,className:(0,a.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",t.forwardRef(({className:e,...t},l)=>(0,s.jsx)("div",{ref:l,className:(0,a.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter",e.s(["Card",()=>l,"CardContent",()=>d,"CardDescription",()=>n,"CardHeader",()=>r,"CardTitle",()=>i])},23750,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(47163);let l=t.forwardRef(({className:e,type:t,...l},r)=>(0,s.jsx)("input",{type:t,className:(0,a.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:r,...l}));l.displayName="Input",e.s(["Input",()=>l])},10708,e=>{"use strict";var s=e.i(43476),t=e.i(71645);e.i(74080);var a=e.i(91918),l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,l)=>{let r=(0,a.createSlot)(`Primitive.${l}`),i=t.forwardRef((e,t)=>{let{asChild:a,...i}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(a?r:l,{...i,ref:t})});return i.displayName=`Primitive.${l}`,{...e,[l]:i}},{}),r=t.forwardRef((e,t)=>(0,s.jsx)(l.label,{...e,ref:t,onMouseDown:s=>{s.target.closest("button, input, select, textarea")||(e.onMouseDown?.(s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));r.displayName="Label";var i=e.i(54406),n=e.i(47163);let d=(0,i.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=t.forwardRef(({className:e,...t},a)=>(0,s.jsx)(r,{ref:a,className:(0,n.cn)(d(),e),...t}));o.displayName=r.displayName,e.s(["Label",()=>o],10708)},71689,e=>{"use strict";let s=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],71689)},56909,e=>{"use strict";let s=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>s],56909)},7479,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(18566),l=e.i(53145),r=e.i(94814),i=e.i(67881),n=e.i(23750),d=e.i(84762),o=e.i(74946),c=e.i(62870),u=e.i(70065),h=e.i(19036),m=e.i(31278),p=e.i(71689),x=e.i(56909),g=e.i(86536),f=e.i(15760),j=e.i(90914),y=e.i(85168),b=e.i(8927),v=e.i(22016);function C(){let e=(0,a.useRouter)(),C=(0,a.useParams)().publicId,[w,F]=(0,t.useState)(!0),[N,S]=(0,t.useState)(!1),[I,k]=(0,t.useState)([]),[P,M]=(0,t.useState)([]),[V,L]=(0,t.useState)([]),[T,R]=(0,t.useState)(null),$=(0,l.useForm)({resolver:(0,r.zodResolver)(y.insightFormSchema),defaultValues:{title:"",slug:"",summary:"",type:"blog",authorId:0,tags:[],coverImageUrl:"",isPublished:!1}});(0,t.useEffect)(()=>{let s=async()=>{F(!0);try{let[e,s,t]=await Promise.all([f.api.get(`/admin/insights/${C}`),f.api.get("/admin/authors"),f.api.get("/admin/tags")]);R(e),M(s),L(t),$.reset({title:e.title,slug:e.slug,summary:e.summary,type:e.type,authorId:e.author?.id??e.authorId??0,tags:e.tags?.map(e=>e.id)||[],coverImageUrl:e.coverImageUrl||"",isPublished:e.isPublished||!1}),e.content&&Array.isArray(e.content)&&k(e.content)}catch(s){console.error("Failed to load data:",s),e.push("/admin/insights")}finally{F(!1)}};C&&s()},[C,$,e]);let B=async s=>{if(0===I.length)return void alert("Please add at least one content block");S(!0);try{let t={title:s.title,slug:s.slug,summary:s.summary,type:s.type,content:I.map(e=>({id:e.id||`${e.type}-${Date.now()}`,type:e.type,data:e.data})),authorId:s.authorId,tags:s.tags||[],coverImageUrl:s.coverImageUrl||void 0};await f.api.patch(`/admin/insights/${C}`,t);let a=T?.isPublished||!1;s.isPublished&&!a?await f.api.patch(`/admin/insights/${C}/publish`):!s.isPublished&&a&&await f.api.patch(`/admin/insights/${C}`,{isPublished:!1}),e.push("/admin/insights"),e.refresh()}catch(t){console.error("Failed to update insight:",t);let e=t?.data?.message||t?.message||"Failed to update insight",s=t?.data?.errors;if(s&&Array.isArray(s)){let t=s.map(e=>"string"==typeof e?e:JSON.stringify(e)).join("\n- ");alert(`Validation error:
${e}
- ${t}`)}else alert(e)}finally{S(!1)}},D=async()=>{let s=$.getValues("isPublished");S(!0);try{s?(await f.api.patch(`/admin/insights/${C}`,{isPublished:!1}),$.setValue("isPublished",!1),T&&(T.isPublished=!1),alert("Insight unpublished successfully")):(await f.api.patch(`/admin/insights/${C}/publish`),$.setValue("isPublished",!0),T&&(T.isPublished=!0),alert("Insight published successfully")),e.refresh()}catch(e){console.error("Failed to toggle publish:",e),alert(e?.data?.message||e?.message||"Failed to toggle publish status")}finally{S(!1)}};return w?(0,s.jsx)("div",{className:"container mx-auto py-6 flex items-center justify-center min-h-[50vh]",children:(0,s.jsx)(m.Loader2,{className:"h-8 w-8 animate-spin"})}):(0,s.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(v.default,{href:"/admin/insights",children:(0,s.jsxs)(i.Button,{variant:"ghost",size:"sm",children:[(0,s.jsx)(p.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Insights"]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Edit Insight"}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Editing: ",T?.title]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(i.Button,{type:"button",variant:T?.isPublished?"outline":"default",onClick:D,disabled:N,children:[(0,s.jsx)(g.Eye,{className:"h-4 w-4 mr-2"}),T?.isPublished?"Unpublish":"Publish Now"]}),(0,s.jsx)(v.default,{href:`/insights/${T?.slug}`,target:"_blank",children:(0,s.jsx)(i.Button,{variant:"outline",size:"sm",children:"View Live"})})]})]}),(0,s.jsx)(o.Form,{...$,children:(0,s.jsx)("form",{onSubmit:$.handleSubmit(B),className:"space-y-8",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-2 space-y-6",children:(0,s.jsxs)(u.Card,{children:[(0,s.jsxs)(u.CardHeader,{children:[(0,s.jsx)(u.CardTitle,{children:"Content Blocks"}),(0,s.jsx)(u.CardDescription,{children:"Edit your insight content blocks"})]}),(0,s.jsx)(u.CardContent,{children:(0,s.jsx)(j.default,{blocks:I,onChange:k,publicId:C})})]})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(u.Card,{children:[(0,s.jsx)(u.CardHeader,{children:(0,s.jsx)(u.CardTitle,{children:"Insight Details"})}),(0,s.jsxs)(u.CardContent,{className:"space-y-4",children:[(0,s.jsx)(o.FormField,{control:$.control,name:"title",render:({field:e})=>(0,s.jsxs)(o.FormItem,{children:[(0,s.jsx)(o.FormLabel,{children:"Title *"}),(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(n.Input,{placeholder:"Enter insight title",...e,onChange:s=>{let t;e.onChange(s);t=s.target.value,$.setValue("title",t),$.getValues("slug")||$.setValue("slug",t.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim())}})}),(0,s.jsx)(o.FormMessage,{})]})}),(0,s.jsx)(o.FormField,{control:$.control,name:"slug",render:({field:e})=>(0,s.jsxs)(o.FormItem,{children:[(0,s.jsx)(o.FormLabel,{children:"Slug *"}),(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(n.Input,{placeholder:"insight-slug",...e})}),(0,s.jsx)(o.FormMessage,{})]})}),(0,s.jsx)(o.FormField,{control:$.control,name:"summary",render:({field:e})=>(0,s.jsxs)(o.FormItem,{children:[(0,s.jsx)(o.FormLabel,{children:"Summary *"}),(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(d.Textarea,{placeholder:"Brief summary of the insight",className:"min-h-[100px]",...e})}),(0,s.jsx)(o.FormMessage,{})]})}),(0,s.jsx)(o.FormField,{control:$.control,name:"type",render:({field:e})=>(0,s.jsxs)(o.FormItem,{children:[(0,s.jsx)(o.FormLabel,{children:"Type *"}),(0,s.jsxs)(c.Select,{onValueChange:e.onChange,value:e.value,children:[(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(c.SelectTrigger,{children:(0,s.jsx)(c.SelectValue,{placeholder:"Select type"})})}),(0,s.jsxs)(c.SelectContent,{children:[(0,s.jsx)(c.SelectItem,{value:"report",children:"Report"}),(0,s.jsx)(c.SelectItem,{value:"publication",children:"Publication"}),(0,s.jsx)(c.SelectItem,{value:"policy-brief",children:"Policy Brief"}),(0,s.jsx)(c.SelectItem,{value:"blog",children:"Blog"})]})]}),(0,s.jsx)(o.FormMessage,{})]})}),(0,s.jsx)(o.FormField,{control:$.control,name:"authorId",render:({field:e})=>(0,s.jsxs)(o.FormItem,{children:[(0,s.jsx)(o.FormLabel,{children:"Author *"}),(0,s.jsxs)(c.Select,{onValueChange:s=>e.onChange(parseInt(s)),value:e.value?.toString(),children:[(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(c.SelectTrigger,{children:(0,s.jsx)(c.SelectValue,{placeholder:"Select author"})})}),(0,s.jsx)(c.SelectContent,{children:P.map(e=>(0,s.jsx)(c.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]}),(0,s.jsx)(o.FormMessage,{})]})}),(0,s.jsx)(o.FormField,{control:$.control,name:"tags",render:({field:e})=>(0,s.jsxs)(o.FormItem,{children:[(0,s.jsx)(o.FormLabel,{children:"Tags"}),(0,s.jsxs)(c.Select,{onValueChange:s=>{let t=parseInt(s),a=e.value||[];a.includes(t)||e.onChange([...a,t])},children:[(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(c.SelectTrigger,{children:(0,s.jsx)(c.SelectValue,{placeholder:"Add tags"})})}),(0,s.jsx)(c.SelectContent,{children:V.map(e=>(0,s.jsx)(c.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.value?.map(t=>{let a=V.find(e=>e.id===t);return a?(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 bg-secondary text-secondary-foreground px-2 py-1 rounded text-sm",children:[a.name,(0,s.jsx)("button",{type:"button",onClick:()=>{e.onChange(e.value?.filter(e=>e!==t))},className:"text-white hover:text-foreground",children:"Ã—"})]},a.id):null})}),(0,s.jsx)(o.FormMessage,{})]})}),(0,s.jsx)(o.FormField,{control:$.control,name:"coverImageUrl",render:({field:e})=>(0,s.jsxs)(o.FormItem,{children:[(0,s.jsx)(o.FormLabel,{children:"Cover Image"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(n.Input,{placeholder:"/uploads/insights/uuid/filename.jpg",...e})}),(0,s.jsx)(b.default,{uploadKey:C,onUploadComplete:s=>e.onChange(s),folder:"insights",disabled:N})]}),(0,s.jsx)(o.FormMessage,{})]})}),(0,s.jsx)(o.FormField,{control:$.control,name:"isPublished",render:({field:e})=>(0,s.jsxs)(o.FormItem,{className:"flex items-center justify-between rounded-lg border p-3",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(o.FormLabel,{children:"Published"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.value?"Publicly visible":"Draft (not visible)"})]}),(0,s.jsx)(o.FormControl,{children:(0,s.jsx)(h.Switch,{checked:e.value,onCheckedChange:e.onChange})})]})})]})]}),(0,s.jsx)(u.Card,{children:(0,s.jsx)(u.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsxs)(i.Button,{type:"submit",disabled:N,className:"w-full",children:[N&&(0,s.jsx)(m.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),(0,s.jsx)(x.Save,{className:"mr-2 h-4 w-4"}),"Save Changes"]}),(0,s.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>e.push("/admin/insights"),children:"Cancel"})]})})})]})]})})})]})}e.s(["default",()=>C])}]);
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,11008,e=>{"use strict";let t=(0,e.i(75254).default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>t],11008)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},84762,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(47163);let a=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("textarea",{className:(0,s.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:a,...r}));a.displayName="Textarea",e.s(["Textarea",()=>a])},69074,e=>{"use strict";let t=(0,e.i(75254).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);e.s(["Upload",()=>t],69074)},31278,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],31278)},86536,e=>{"use strict";let t=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],86536)},64659,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],64659)},59411,e=>{"use strict";var t=e.i(71645),r=e.i(48425),s=e.i(43476),a=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),l=t.forwardRef((e,t)=>(0,s.jsx)(r.Primitive.span,{...e,ref:t,style:{...a,...e.style}}));l.displayName="VisuallyHidden",e.s(["VISUALLY_HIDDEN_STYLES",()=>a,"VisuallyHidden",()=>l])},70065,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(47163);let a=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("rounded-xl border bg-card text-card-foreground shadow",e),...r}));a.displayName="Card";let l=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...r}));l.displayName="CardHeader";let i=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("font-semibold leading-none tracking-tight",e),...r}));i.displayName="CardTitle";let n=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("text-sm text-muted-foreground",e),...r}));n.displayName="CardDescription";let o=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",e),...r}));o.displayName="CardContent",r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",e),...r})).displayName="CardFooter",e.s(["Card",()=>a,"CardContent",()=>o,"CardDescription",()=>n,"CardHeader",()=>l,"CardTitle",()=>i])},23750,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(47163);let a=r.forwardRef(({className:e,type:r,...a},l)=>(0,t.jsx)("input",{type:r,className:(0,s.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:l,...a}));a.displayName="Input",e.s(["Input",()=>a])},10708,e=>{"use strict";var t=e.i(43476),r=e.i(71645);e.i(74080);var s=e.i(91918),a=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,a)=>{let l=(0,s.createSlot)(`Primitive.${a}`),i=r.forwardRef((e,r)=>{let{asChild:s,...i}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(s?l:a,{...i,ref:r})});return i.displayName=`Primitive.${a}`,{...e,[a]:i}},{}),l=r.forwardRef((e,r)=>(0,t.jsx)(a.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var i=e.i(54406),n=e.i(47163);let o=(0,i.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(l,{ref:s,className:(0,n.cn)(o(),e),...r}));d.displayName=l.displayName,e.s(["Label",()=>d],10708)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},60316,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(22016),a=e.i(18566),l=e.i(53145),i=e.i(94814),n=e.i(67881),o=e.i(23750),d=e.i(84762),c=e.i(74946),u=e.i(62870),m=e.i(70065),h=e.i(19036),x=e.i(31278),p=e.i(71689),g=e.i(15760),f=e.i(90914),j=e.i(8927),y=e.i(85168);let b=()=>"undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():`tmp-${Date.now()}-${Math.random().toString(16).slice(2)}`;function v(){let e=(0,a.useRouter)(),[v,C]=(0,r.useState)(!1),[w,F]=(0,r.useState)([]),[N,S]=(0,r.useState)([]),[I,k]=(0,r.useState)([]),[M]=(0,r.useState)(b),P=(0,l.useForm)({resolver:(0,i.zodResolver)(y.insightFormSchema),defaultValues:{title:"",slug:"",summary:"",type:"blog",authorId:0,tags:[],coverImageUrl:"",isPublished:!1},mode:"onSubmit"});(0,r.useEffect)(()=>{(async()=>{try{let[e,t]=await Promise.all([g.api.get("/admin/authors"),g.api.get("/admin/tags")]);S(e),k(t)}catch(e){console.error("Failed to load data:",e)}})()},[]);let L=async t=>{if(0===w.length)return void alert("Please add at least one content block");if(0===t.authorId)return void alert("Please select an author");let r=[];if(t.title.trim()||r.push("Title is required"),t.slug.trim()||r.push("Slug is required"),t.summary.trim()||r.push("Summary is required"),0===t.authorId&&r.push("Author is required"),0===w.length&&r.push("At least one content block is required"),r.length>0)return void alert(`Please fix the following errors:
${r.join("\n")}`);C(!0);try{let r={title:t.title,slug:t.slug,summary:t.summary,type:t.type,content:w.map(e=>({id:e.id||`${e.type}-${Date.now()}`,type:e.type,data:e.data})),authorId:t.authorId,tags:t.tags||[],coverImageUrl:t.coverImageUrl||void 0,isPublished:t.isPublished??!1,publicId:M};console.log("Submitting data:",JSON.stringify(r,null,2));let s=await g.api.post("/admin/insights",r);console.log("Response:",s),e.push("/admin/insights"),e.refresh()}catch(t){if(console.error("Failed to create insight:",t),console.error("Error details:",t?.data),t?.status===400){let e=t?.data?.errors,r=t?.data?.message,s=Array.isArray(e)?e.map(e=>"string"==typeof e?e:JSON.stringify(e)).join("\n- "):e&&"object"==typeof e?JSON.stringify(e,null,2):"";alert(`Validation error:
${r||""}${s?`
- ${s}`:""}`)}else t?.status===401?(alert("Session expired. Please login again."),e.push("/admin/login")):alert(t?.message||"Failed to create insight")}finally{C(!1)}};return(0,t.jsxs)("div",{className:"container mx-auto py-6 space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(s.default,{href:"/admin/insights",children:(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",children:[(0,t.jsx)(p.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Back to Insights"]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Create New Insight"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Add a new insight with block-based content"})]})]})}),(0,t.jsx)(c.Form,{...P,children:(0,t.jsx)("form",{onSubmit:P.handleSubmit(L),className:"space-y-8",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2 space-y-6",children:(0,t.jsxs)(m.Card,{children:[(0,t.jsxs)(m.CardHeader,{children:[(0,t.jsx)(m.CardTitle,{children:"Content Blocks"}),(0,t.jsx)(m.CardDescription,{children:"Build your insight using different content blocks"})]}),(0,t.jsx)(m.CardContent,{children:(0,t.jsx)(f.default,{blocks:w,onChange:F,publicId:M})})]})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(m.Card,{children:[(0,t.jsx)(m.CardHeader,{children:(0,t.jsx)(m.CardTitle,{children:"Insight Details"})}),(0,t.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,t.jsx)(c.FormField,{control:P.control,name:"title",render:({field:e})=>(0,t.jsxs)(c.FormItem,{children:[(0,t.jsx)(c.FormLabel,{children:"Title *"}),(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(o.Input,{placeholder:"Enter insight title",...e,onChange:t=>{e.onChange(t);let r=t.target.value;P.setValue("title",r),P.getValues("slug")||P.setValue("slug",r.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim())}})}),(0,t.jsx)(c.FormMessage,{})]})}),(0,t.jsx)(c.FormField,{control:P.control,name:"slug",render:({field:e})=>(0,t.jsxs)(c.FormItem,{children:[(0,t.jsx)(c.FormLabel,{children:"Slug *"}),(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(o.Input,{placeholder:"insight-slug",...e})}),(0,t.jsx)(c.FormMessage,{})]})}),(0,t.jsx)(c.FormField,{control:P.control,name:"summary",render:({field:e})=>(0,t.jsxs)(c.FormItem,{children:[(0,t.jsx)(c.FormLabel,{children:"Summary *"}),(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(d.Textarea,{placeholder:"Brief summary of the insight",className:"min-h-[100px]",...e})}),(0,t.jsx)(c.FormMessage,{})]})}),(0,t.jsx)(c.FormField,{control:P.control,name:"type",render:({field:e})=>(0,t.jsxs)(c.FormItem,{children:[(0,t.jsx)(c.FormLabel,{children:"Type *"}),(0,t.jsxs)(u.Select,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Select type"})})}),(0,t.jsxs)(u.SelectContent,{children:[(0,t.jsx)(u.SelectItem,{value:"report",children:"Report"}),(0,t.jsx)(u.SelectItem,{value:"publication",children:"Publication"}),(0,t.jsx)(u.SelectItem,{value:"policy-brief",children:"Policy Brief"}),(0,t.jsx)(u.SelectItem,{value:"blog",children:"Blog"})]})]}),(0,t.jsx)(c.FormMessage,{})]})}),(0,t.jsx)(c.FormField,{control:P.control,name:"authorId",render:({field:e})=>(0,t.jsxs)(c.FormItem,{children:[(0,t.jsx)(c.FormLabel,{children:"Author *"}),(0,t.jsxs)(u.Select,{onValueChange:t=>{let r=parseInt(t,10);e.onChange(r)},value:"number"==typeof e.value&&0!==e.value?e.value.toString():"",children:[(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Select author"})})}),(0,t.jsx)(u.SelectContent,{children:0===N.length?(0,t.jsx)(u.SelectItem,{value:"loading",disabled:!0,children:"Loading authors..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.SelectItem,{value:"select",disabled:!0,children:"Select an author"}),N.map(e=>(0,t.jsx)(u.SelectItem,{value:e.id.toString(),children:e.name},e.id))]})})]}),(0,t.jsx)(c.FormMessage,{})]})}),(0,t.jsx)(c.FormField,{control:P.control,name:"tags",render:({field:e})=>(0,t.jsxs)(c.FormItem,{children:[(0,t.jsx)(c.FormLabel,{children:"Tags"}),(0,t.jsxs)(u.Select,{onValueChange:t=>{let r=parseInt(t,10),s=e.value||[];s.includes(r)||e.onChange([...s,r])},children:[(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(u.SelectTrigger,{children:(0,t.jsx)(u.SelectValue,{placeholder:"Add tags"})})}),(0,t.jsx)(u.SelectContent,{children:I.map(e=>(0,t.jsx)(u.SelectItem,{value:e.id.toString(),children:e.name},e.id))})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.value?.map(r=>{let s=I.find(e=>e.id===r);return s?(0,t.jsxs)("div",{className:"inline-flex items-center gap-1 bg-secondary text-secondary-foreground px-2 py-1 rounded text-sm",children:[s.name,(0,t.jsx)("button",{type:"button",onClick:()=>{e.onChange(e.value?.filter(e=>e!==r))},className:"text-muted-foreground hover:text-foreground",children:"Ã—"})]},s.id):null})}),(0,t.jsx)(c.FormMessage,{})]})}),(0,t.jsx)(c.FormField,{control:P.control,name:"coverImageUrl",render:({field:e})=>(0,t.jsxs)(c.FormItem,{children:[(0,t.jsx)(c.FormLabel,{children:"Cover Image"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(o.Input,{placeholder:"/uploads/insights/uuid/filename.jpg",...e})}),(0,t.jsx)(j.default,{uploadKey:M,onUploadComplete:t=>e.onChange(t),folder:"insights",disabled:v})]}),(0,t.jsx)(c.FormMessage,{})]})}),(0,t.jsx)(c.FormField,{control:P.control,name:"isPublished",render:({field:e})=>(0,t.jsxs)(c.FormItem,{className:"flex items-center justify-between rounded-lg border p-3",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(c.FormLabel,{children:"Publish Immediately"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Make this insight publicly visible"})]}),(0,t.jsx)(c.FormControl,{children:(0,t.jsx)(h.Switch,{checked:e.value,onCheckedChange:e.onChange})})]})})]})]}),(0,t.jsx)(m.Card,{children:(0,t.jsx)(m.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsxs)(n.Button,{type:"submit",disabled:v,className:"w-full",children:[v&&(0,t.jsx)(x.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Insight"]}),(0,t.jsxs)(n.Button,{type:"button",variant:"outline",onClick:async()=>{if(!await P.trigger())return;let e=P.getValues();P.setValue("isPublished",!1);let t={...e,authorId:Number(e.authorId)||0,tags:Array.isArray(e.tags)?e.tags.map(e=>Number(e)).filter(e=>!isNaN(e)):[],isPublished:!1};await L(t)},disabled:v,children:[v&&(0,t.jsx)(x.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Save as Draft"]})]})})})]})]})})})]})}e.s(["default",()=>v])}]);
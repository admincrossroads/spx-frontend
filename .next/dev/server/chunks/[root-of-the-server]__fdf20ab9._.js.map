{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Victus/Documents/Spiralytix/Website/spiralytix-site/app/api/auth/check/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\n\r\nconst API_URL = process.env.NEXT_PUBLIC_API_URL;\r\nconst API_KEY = process.env.NEXT_PUBLIC_API_KEY;\r\n\r\nexport async function GET(request: NextRequest) {\r\n  // #region agent log\r\n  const fs = await import('fs/promises');\r\n  const logPath = '.cursor/debug.log';\r\n  const logEntry = JSON.stringify({location:'api/auth/check/route.ts:7',message:'Auth check API entry',data:{timestamp:Date.now()},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})+'\\n';\r\n  await fs.appendFile(logPath, logEntry).catch(()=>{});\r\n  // #endregion\r\n  try {\r\n    // Get token from Authorization header (localStorage flow)\r\n    const authHeader = request.headers.get('Authorization');\r\n    // #region agent log\r\n    const logEntry2 = JSON.stringify({location:'api/auth/check/route.ts:12',message:'Authorization header check',data:{hasAuthHeader:!!authHeader,authHeaderPrefix:authHeader?.substring(0,20)||'none'},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})+'\\n';\r\n    await fs.appendFile(logPath, logEntry2).catch(()=>{});\r\n    // #endregion\r\n    const token = authHeader?.startsWith('Bearer ') ? authHeader.substring(7) : null;\r\n    \r\n    // #region agent log\r\n    const logEntry3 = JSON.stringify({location:'api/auth/check/route.ts:16',message:'Token extracted from Authorization header',data:{tokenLength:token?.length || 0},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})+'\\n';\r\n    await fs.appendFile(logPath, logEntry3).catch(()=>{});\r\n    // #endregion\r\n\r\n    if (!token) {\r\n      // #region agent log\r\n      const logEntry5 = JSON.stringify({location:'api/auth/check/route.ts:25',message:'No token found, returning false',data:{},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})+'\\n';\r\n      await fs.appendFile(logPath, logEntry5).catch(()=>{});\r\n      // #endregion\r\n      return NextResponse.json({ authenticated: false });\r\n    }\r\n\r\n    if (!API_URL || !API_KEY) {\r\n      // #region agent log\r\n      const logEntry6 = JSON.stringify({location:'api/auth/check/route.ts:31',message:'Missing API environment variables',data:{hasApiUrl:!!API_URL,hasApiKey:!!API_KEY},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})+'\\n';\r\n      await fs.appendFile(logPath, logEntry6).catch(()=>{});\r\n      // #endregion\r\n      console.error('Missing API environment variables');\r\n      return NextResponse.json({ authenticated: false });\r\n    }\r\n\r\n    // Quick check with backend\r\n    // #region agent log\r\n    const logEntry7 = JSON.stringify({location:'api/auth/check/route.ts:36',message:'Before backend API call',data:{apiUrl:API_URL?.substring(0,50)||'none'},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})+'\\n';\r\n    await fs.appendFile(logPath, logEntry7).catch(()=>{});\r\n    // #endregion\r\n    const response = await fetch(`${API_URL}/auth/me`, {\r\n      method: 'HEAD',\r\n      headers: {\r\n        'x-api-key': API_KEY,\r\n        'Authorization': `Bearer ${token}`,\r\n      },\r\n      cache: 'no-store',\r\n    });\r\n    // #region agent log\r\n    const logEntry8 = JSON.stringify({location:'api/auth/check/route.ts:46',message:'Backend API response received',data:{status:response.status,statusText:response.statusText,ok:response.ok},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'D'})+'\\n';\r\n    await fs.appendFile(logPath, logEntry8).catch(()=>{});\r\n    // #endregion\r\n\r\n    return NextResponse.json({\r\n      authenticated: response.ok\r\n    });\r\n  } catch (error: any) {\r\n    // #region agent log\r\n    const fs = await import('fs/promises');\r\n    const logPath = '.cursor/debug.log';\r\n    const logEntry9 = JSON.stringify({location:'api/auth/check/route.ts:53',message:'Auth check API error caught',data:{errorMessage:error?.message,errorName:error?.name},timestamp:Date.now(),sessionId:'debug-session',runId:'run1',hypothesisId:'B'})+'\\n';\r\n    await fs.appendFile(logPath, logEntry9).catch(()=>{});\r\n    // #endregion\r\n    console.error('Auth check error:', error);\r\n    return NextResponse.json({ authenticated: false });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}